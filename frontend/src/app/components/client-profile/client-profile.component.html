<div class="client-profile">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <mat-spinner diameter="48"></mat-spinner>
    <div class="loading-text">Loading Profile...</div>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="error-container">
    <mat-icon>error_outline</mat-icon>
    <p>{{ error }}</p>
  </div>

  <!-- Profile Content -->
  <div *ngIf="!isLoading && !error && userProfile" class="profile-container">
    <!-- Profile Header -->
    <app-profile-header
      [userProfile]="userProfile"
      [isGeneratingWorkoutPlan]="isGeneratingWorkoutPlan"
      (generateWorkoutPlan)="generateWorkoutPlan()">
    </app-profile-header>
    
    <div class="profile-content">
      <!-- Left Column -->
      <div class="left-column">
        <!-- Personal Info Card -->
        <app-personal-info-card 
          [clientInfo]="personalProfile" 
          (edit)="onEditPersonalInfo()">
        </app-personal-info-card>

        <!-- Stats Grid -->
        <app-stats-grid 
          [goals]="goals" 
          [selectedTimeFrame]="selectedTimeFrame"
          (timeFrameChange)="selectedTimeFrame = $event">
        </app-stats-grid>
      </div>

      <!-- Right Column -->
      <div class="right-column">
        <!-- Performance Overview Card -->
        <div class="performance-card">
          <div class="card-header">
            <h2>Performance Overview</h2>
            <div class="time-frame-selector">
              <button 
                *ngFor="let timeFrame of timeFrames" 
                [class.active]="selectedTimeFrame === timeFrame"
                (click)="selectedTimeFrame = timeFrame">
                {{timeFrame | titlecase}}
              </button>
            </div>
          </div>

          <div class="quick-stats">
            <div class="stat-item">
              <mat-icon>fitness_center</mat-icon>
              <div class="stat-info">
                <span class="stat-value">{{ totalAiWorkouts }}</span>
                <span class="stat-label">Workouts</span>
              </div>
            </div>
            <div class="stat-item">
              <mat-icon>timer</mat-icon>
              <div class="stat-info">
                <span class="stat-value">{{ totalAiWorkoutHours | number:'1.1-1' }}h</span>
                <span class="stat-label">Duration</span>
              </div>
            </div>
            <div class="stat-item">
              <mat-icon>local_fire_department</mat-icon>
              <div class="stat-info">
                <span class="stat-value">{{ totalAiCalories | number }}</span>
                <span class="stat-label">Calories</span>
              </div>
            </div>
            <div class="stat-item">
              <mat-icon>trending_up</mat-icon>
              <div class="stat-info">
                <span class="stat-value">85%</span>
                <span class="stat-label">Progress</span>
              </div>
            </div>
          </div>

          <div class="charts-grid">
            <div class="chart-container">
              <div class="chart-header">
                <h3>Progress Chart</h3>
                <button mat-icon-button (click)="openAddWeightModal()" class="add-weight-btn" matTooltip="Add Weight Measurement">
                  <mat-icon>add_circle</mat-icon>
                </button>
              </div>
              
              <!-- Add Weight Expansion Panel -->
              <app-add-weight-modal
                [isOpen]="showWeightModal"
                (closeModal)="handleWeightModalClose()"
                (submitMeasurement)="handleWeightMeasurementSubmit($event)">
              </app-add-weight-modal>

              <highcharts-chart
                [Highcharts]="Highcharts"
                [options]="progressChartOptions"
                style="width: 100%; height: 140px; display: block;">
              </highcharts-chart>
            </div>
            <div class="chart-container">
              <div class="chart-header">
                <h3>Nutrition Distribution</h3>
              </div>
              <highcharts-chart
                [Highcharts]="Highcharts"
                [options]="nutritionChartOptions"
                style="width: 100%; height: 140px; display: block;">
              </highcharts-chart>
            </div>
          </div>

          <div class="workout-history">
            <div class="history-header">
              <h3>Recent Workouts</h3>
            </div>
            <div class="workout-cards">
              <div *ngFor="let workout of workoutHistory" class="workout-card">
                <div class="card-header" (click)="toggleCardExpansion(workout.id)">
                  <div class="header-main">
                    <div class="workout-date">
                      <mat-icon class="date-icon">calendar_today</mat-icon>
                      {{workout.workoutDate | date:'MMM d, y'}}
                    </div>
                    <div class="workout-type">
                      <mat-icon class="type-icon">fitness_center</mat-icon>
                      {{workout.workoutType}}
                    </div>
                  </div>
                  <div class="header-stats">
                    <div class="stat-item">
                      <mat-icon>timer</mat-icon>
                      <span>{{workout.durationMinutes}} min</span>
                    </div>
                    <div class="stat-item">
                      <mat-icon>local_fire_department</mat-icon>
                      <span>{{workout.caloriesBurnt}} cal</span>
                    </div>
                  </div>
                  <mat-icon class="expand-icon">{{ isCardExpanded(workout.id) ? 'expand_less' : 'expand_more' }}</mat-icon>
                </div>
                
                <div class="card-details" [class.expanded]="isCardExpanded(workout.id)">
                  <div class="exercises-section">
                    <div class="section-title">
                      <mat-icon>fitness_center</mat-icon>
                      <span>Exercises</span>
                    </div>
                    <div class="exercise-list">
                      <div *ngFor="let exercise of workout.exercises" class="exercise-item">
                        <div class="exercise-header">
                          <span class="exercise-name">{{exercise.name}}</span>
                        </div>
                        <div class="exercise-metrics">
                          <div class="metric">
                            <span class="metric-value">{{exercise.sets}}</span>
                            <span class="metric-label">Sets</span>
                          </div>
                          <div class="metric-divider"></div>
                          <div class="metric">
                            <span class="metric-value">{{exercise.reps}}</span>
                            <span class="metric-label">Reps</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <div class="notes-section" *ngIf="workout.notes">
                    <div class="section-title">
                      <mat-icon>note</mat-icon>
                      <span>Notes</span>
                    </div>
                    <div class="notes-content">{{workout.notes}}</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Timeline Activity -->
          <!--<div class="timeline-section">
            <div class="section-header">
              <h2>Activity Timeline</h2>
            </div>
            <app-timeline-activity [activities]="activities.slice(0, 3)"></app-timeline-activity>
          </div>-->

          <!-- Progress Gallery -->
          <app-progress-gallery [photos]="progressPhotos"></app-progress-gallery>
        </div>
      </div>
    </div>
  </div>
</div>
